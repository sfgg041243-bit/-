<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì˜¤ëŠ˜ì˜ ê°œëœ¬ê¸ˆ í¬ì¸ˆì¿ í‚¤</title>
  <meta name="description" content="ì˜ë¯¸ ì—†ëŠ” ë§ 500ê°œ. í•˜ë£¨ 1ê°œ. ëœë¤. ì €ì¥." />
  <style>
    :root{
      --bg0:#070A12;
      --bg1:#0B1020;
      --card:rgba(255,255,255,.06);
      --line:rgba(255,255,255,.12);
      --text:#ECF2FF;
      --muted:rgba(236,242,255,.68);
      --accent:#7DD3FC;
      --accent2:#A7F3D0;
      --pink:#FB7185;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --r1:18px;
      --r2:26px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, Noto Sans KR, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font);
      color:var(--text);
      background:
        radial-gradient(900px 500px at 20% 0%, rgba(125,211,252,.16), transparent 60%),
        radial-gradient(900px 500px at 80% 0%, rgba(167,243,208,.12), transparent 60%),
        radial-gradient(1000px 600px at 50% 120%, rgba(251,113,133,.08), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
    }
    .wrap{max-width:980px;margin:0 auto;padding:18px}
    .top{
      display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap;
      margin-bottom:14px;
    }
    .brand{display:flex;gap:12px;align-items:center}
    .logo{
      width:44px;height:44px;border-radius:16px;display:grid;place-items:center;
      background:linear-gradient(135deg, rgba(125,211,252,.22), rgba(167,243,208,.14));
      border:1px solid rgba(125,211,252,.28);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      font-size:20px;
    }
    h1{margin:0;font-size:18px;letter-spacing:.2px}
    .sub{margin-top:4px;font-size:12px;color:var(--muted)}
    .pillbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:flex-end}
    .pill{
      padding:9px 12px;border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.03);
      color:var(--muted);
      font-size:12px;
      backdrop-filter: blur(10px);
      white-space:nowrap;
    }

    .panel{
      border:1px solid var(--line);
      border-radius:var(--r2);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .hd{
      padding:14px 14px 12px;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      border-bottom:1px solid rgba(255,255,255,.08);
      background:rgba(0,0,0,.14);
      flex-wrap:wrap;
    }
    .hd b{font-size:14px}
    .hd .right{display:flex;gap:8px;flex-wrap:wrap}
    button{
      cursor:pointer;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      color:var(--text);
      border-radius:14px;
      padding:10px 12px;
      font:inherit;
      transition:.16s transform,.16s background,.16s border-color;
      white-space:nowrap;
    }
    button:hover{background:rgba(255,255,255,.10);border-color:rgba(255,255,255,.18)}
    button:active{transform:scale(.98)}
    .btn-primary{
      background:linear-gradient(135deg, rgba(125,211,252,.26), rgba(167,243,208,.14));
      border-color:rgba(125,211,252,.32);
    }
    .btn-pink{
      background:linear-gradient(135deg, rgba(251,113,133,.22), rgba(125,211,252,.10));
      border-color:rgba(251,113,133,.28);
    }

    .bd{padding:14px}
    .card{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.16);
      border-radius:var(--r2);
      padding:18px 16px;
      position:relative;
      overflow:hidden;
    }
    .card:before{
      content:"";
      position:absolute;inset:-2px;
      background:
        radial-gradient(700px 280px at 30% 0%, rgba(125,211,252,.16), transparent 60%),
        radial-gradient(700px 280px at 80% 10%, rgba(167,243,208,.12), transparent 60%);
      opacity:.55;pointer-events:none;
    }
    .card > *{position:relative}

    .label{
      display:inline-flex;align-items:center;gap:8px;
      font-size:12px;color:var(--muted);
      padding:6px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.03);
      margin-bottom:12px;
      white-space:nowrap;
    }
    .fortune{
      font-weight:900;
      font-size:28px;
      line-height:1.18;
      letter-spacing:-.4px;
      margin:0;
      text-align:center;
    }
    .meta{
      margin-top:12px;
      display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;
      color:var(--muted);
      font-size:12px;
    }
    .actions{
      margin-top:14px;
      display:flex;gap:10px;flex-wrap:wrap;
    }
    .actions button{flex:1;min-width:140px}

    .grid{
      margin-top:14px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width:820px){.grid{grid-template-columns:1fr}}

    .list{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.12);
      border-radius:var(--r2);
      padding:12px;
      max-height:280px;
      overflow:auto;
    }
    .item{
      display:flex;gap:10px;align-items:flex-start;justify-content:space-between;
      padding:10px 10px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.08);
      background:rgba(255,255,255,.03);
      margin-bottom:10px;
    }
    .item:last-child{margin-bottom:0}
    .item .t{
      font-size:13px;line-height:1.4;
      color:rgba(236,242,255,.86);
      word-break:break-word;
    }
    .item .s{
      font-size:11px;color:var(--muted);
      margin-top:6px;
    }
    .mini{
      display:flex;gap:8px;align-items:center;
      flex:0 0 auto;
    }
    .mini button{
      padding:8px 10px;border-radius:12px;
      font-size:12px;
      min-width:auto;
      flex:0 0 auto;
    }

    .toast{
      position:fixed;left:50%;bottom:18px;transform:translateX(-50%);
      background:rgba(0,0,0,.78);
      border:1px solid rgba(255,255,255,.12);
      padding:10px 12px;border-radius:14px;
      color:var(--text);
      display:none;
      z-index:60;
      box-shadow: 0 14px 40px rgba(0,0,0,.35);
      font-size:13px;
      backdrop-filter: blur(10px);
      max-width:92vw;
    }
    .hint{
      margin-top:10px;
      color:var(--muted);
      font-size:12px;
      line-height:1.45;
    }
    .hint code{
      background:rgba(255,255,255,.06);
      padding:2px 6px;border-radius:8px;
      border:1px solid rgba(255,255,255,.10);
      color:rgba(236,242,255,.86);
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand">
        <div class="logo">ğŸ¥ </div>
        <div>
          <h1>ì˜¤ëŠ˜ì˜ ê°œëœ¬ê¸ˆ í¬ì¸ˆì¿ í‚¤</h1>
          <div class="sub">ì˜ë¯¸ ì—†ìŒ 500ê°œ Â· í•˜ë£¨ 1ê°œ ê³ ì • Â· ëœë¤ ë½‘ê¸° ê°€ëŠ¥</div>
        </div>
      </div>

      <div class="pillbar">
        <div class="pill" id="poolInfo">ë¬¸ì¥ í’€: 500ê°œ</div>
        <div class="pill" id="todayKey">ì˜¤ëŠ˜ í‚¤: -</div>
      </div>
    </div>

    <section class="panel">
      <div class="hd">
        <b>ğŸ€ ì˜¤ëŠ˜ì˜ ê°œì†Œë¦¬</b>
        <div class="right">
          <button class="btn-primary" id="btnOpen">ì˜¤ëŠ˜ ì—´ê¸°</button>
          <button id="btnRandom" class="btn-pink">ëœë¤ ë½‘ê¸°</button>
          <button id="btnReset">ì˜¤ëŠ˜ ì´ˆê¸°í™”</button>
        </div>
      </div>

      <div class="bd">
        <div class="card">
          <div class="label" id="labelMode">ì•„ì§ ì•ˆ ì—´ì—ˆìŒ</div>
          <p class="fortune" id="fortuneText">ë²„íŠ¼ ëˆŒëŸ¬ë¼ì‰.</p>
          <div class="meta">
            <div id="metaLeft">â€”</div>
            <div id="metaRight">â€”</div>
          </div>

          <div class="actions">
            <button id="btnSave">â­ ì €ì¥</button>
            <button id="btnCopy">ğŸ“‹ ë³µì‚¬</button>
          </div>

          <div class="hint">
            - <code>ì˜¤ëŠ˜ ì—´ê¸°</code>ëŠ” í•˜ë£¨ 1ë²ˆ ê³ ì •<br/>
            - <code>ëœë¤ ë½‘ê¸°</code>ëŠ” ê·¸ëƒ¥ ë½‘ê¸°(ì˜ë¯¸ ì—†ìŒ, vibe only)<br/>
            - ì €ì¥ì€ ì´ ë¸Œë¼ìš°ì €ì—ë§Œ ë‚¨ëŠ”ë‹¤ (localStorage)
          </div>
        </div>

        <div class="grid">
          <div>
            <div class="label">â­ ì €ì¥í•œ ë¬¸ì¥</div>
            <div class="list" id="savedList"></div>
          </div>
          <div>
            <div class="label">ğŸ•’ íˆìŠ¤í† ë¦¬ (ìµœê·¼ 20ê°œ)</div>
            <div class="list" id="historyList"></div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <div class="toast" id="toast">ë³µì‚¬ë¨</div>

<script>
/* =========================
   0) ìœ í‹¸
   ========================= */
const $ = (id)=>document.getElementById(id);

function toast(msg){
  const t = $("toast");
  t.textContent = msg;
  t.style.display = "block";
  clearTimeout(window.__toastTimer);
  window.__toastTimer = setTimeout(()=>{ t.style.display="none"; }, 1300);
}

function pad2(n){ return String(n).padStart(2,"0"); }

function todayKey(){
  const d = new Date();
  return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
}

/* (seeded RNG) */
function mulberry32(seed){
  return function(){
    let t = seed += 0x6D2B79F5;
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  }
}
function hashStr(s){
  // ê°„ë‹¨ ë¬¸ìì—´ í•´ì‹œ
  let h = 2166136261;
  for(let i=0;i<s.length;i++){
    h ^= s.charCodeAt(i);
    h = Math.imul(h, 16777619);
  }
  return h >>> 0;
}
function pick(rng, arr){
  return arr[Math.floor(rng() * arr.length)];
}
function josa(rng, word, a, b){
  // ì•„ì£¼ ëŒ€ì¶©: ë°›ì¹¨ ì—¬ë¶€ë¡œ ì¡°ì‚¬ ì„ íƒ(ëŒ€ì¶©ì´ë¼ ë” ì›ƒê¹€)
  const last = word.charCodeAt(word.length-1);
  const hasBatchim = (last >= 0xAC00 && last <= 0xD7A3) ? ((last - 0xAC00) % 28 !== 0) : (rng() < 0.5);
  return word + (hasBatchim ? a : b);
}

/* =========================
   1) â€œê³ ì • ë¬¸ì¥â€ (ë„¤ ì·¨í–¥ í•µì‹¬)
   ========================= */
const fixed = [
  "ë„ˆëŠ” ë°©ê·€ìŸì´ ë¿¡ë¿¡ì´ë‹¤.",
  "ì˜¤ëŠ˜ì€ ì–‘ë§ì´ ë„ˆë¥¼ ì‹«ì–´í•œë‹¤.",
  "ê³ ì–‘ì´ëŠ” ì•Œê³  ìˆë‹¤. ê·¼ë° ì•ˆ ì•Œë ¤ì¤€ë‹¤.",
  "ê°‘ìê¸° ì˜¤ì´ê°€ ìƒê°ë‚œë‹¤. ì´ìœ ëŠ” ì—†ë‹¤.",
  "ë„¤ê°€ ì§€ê¸ˆ ê¹œë¹¡í•œ ê±´ ì¤‘ìš”í•˜ì§€ ì•Šë‹¤. ì•„ë§ˆë„.",
  "ìˆŸê°€ë½ì€ ì˜¤ëŠ˜ë„ í¬í¬ë¥¼ ë¬´ì‹œí–ˆë‹¤.",
  "ì—˜ë¦¬ë² ì´í„°ëŠ” ë„ˆë¥¼ ì‹œí—˜í•˜ê³  ìˆë‹¤.",
  "ë°”ë‚˜ë‚˜ëŠ” ë°”ë‚˜ë‚˜ë‹µê²Œ ì‚´ê³  ìˆë‹¤.",
  "ì˜¤ëŠ˜ì€ ë¬¼ì´ ë§›ì´ ì—†ë‹¤. ë„¤ íƒ“ì´ë‹¤.",
  "ë°©ê¸ˆ ìƒê°í•œ ê·¸ê±´ ì•„ë‹ˆë‹¤. ì ˆëŒ€.",
  "ë„ˆëŠ” ì‚¬ì‹¤ ë¹„ë‘˜ê¸°ë‘ ë‹®ì•˜ë‹¤.",
  "ë„¤ ì¸ìƒì€ ì§€ê¸ˆ â€˜ë¡œë”©ì¤‘â€™ì´ë‹¤. ë¡œë”©ë§Œ.",
  "ì˜¤ëŠ˜ì˜ í–‰ìš´ ìƒ‰ê¹”ì€ ê·¸ëƒ¥ íšŒìƒ‰ì´ë‹¤.",
  "ë„ˆëŠ” ì§€ê¸ˆ ì•„ë¬´ ì˜ë¯¸ ì—†ì´ ì´ê±¸ ì½ê³  ìˆë‹¤.",
  "ì–‘íŒŒëŠ” ì–µìš¸í•˜ë‹¤.",
  "ì˜¤ëŠ˜ì€ ì™¼ìª½ ì‹ ë°œì´ ìš°ì„¸í•˜ë‹¤.",
  "í† ë§ˆí† ëŠ” ì•„ì§ë„ ê³¼ì¼ì¸ ì²™í•œë‹¤.",
  "ì´ ë¬¸ì¥ì€ ê³§ ìŠíŒë‹¤.",
  "ë„¤ ì–‘ë§ í•œ ì§ì€ ë‹¤ë¥¸ ì‚¶ì„ ì‚´ê³  ìˆë‹¤.",
  "ì˜¤ëŠ˜ì˜ ìš´ì„¸: ê·¸ëƒ¥ ê·¸ëŸ¼."
];

/* =========================
   2) ìë™ ìƒì„±ê¸°: â€œê°œëœ¬ê¸ˆ ë¬¸ì¥ 500ê°œ í’€â€ ë§Œë“¤ê¸°
   ========================= */
function buildPool500(){
  const pool = [...fixed];

  // ì‚¬ë¬¼/ë™ë¬¼/ê°œë… (ì˜ì¸í™”ìš©)
  const nouns = [
    "ì–‘ë§", "ë¹„ë‘˜ê¸°", "ì˜¤ì´", "ì–‘íŒŒ", "í† ë§ˆí† ", "ë°”ë‚˜ë‚˜", "ìˆ˜ê±´", "ë² ê°œ", "ëƒ‰ì¥ê³ ", "ë¦¬ëª¨ì»¨",
    "ì—˜ë¦¬ë² ì´í„°", "ì‹ í˜¸ë“±", "ìš°ì‚°", "ìŠ¬ë¦¬í¼", "ì±…ìƒ", "ì˜ì", "ì°½ë¬¸", "êµ¬ë¦„", "ë°”ë‹¥", "ì»µë¼ë©´",
    "í¬í¬", "ìˆŸê°€ë½", "ì “ê°€ë½", "ì¹˜ì•½", "ì¹«ì†”", "íœ´ì§€", "ë¬¼í‹°ìŠˆ", "ê³ ë¬´ì¤„", "ì§€ìš°ê°œ", "ì—°í•„",
    "ë§ˆìš°ìŠ¤", "í‚¤ë³´ë“œ", "ì™€ì´íŒŒì´", "ë°°í„°ë¦¬", "ì¶©ì „ê¸°", "ì´ì–´í°", "ëª¨ë‹ˆí„°", "ì‹œê³„", "ë‹¬ë ¥", "ê±°ìš¸",
    "ê³ ì–‘ì´", "ê°•ì•„ì§€", "ë¬¸ì–´", "ê¸ˆë¶•ì–´", "í–„ìŠ¤í„°", "ì°¸ìƒˆ", "ê°œë¯¸", "ëª¨ê¸°", "íŒŒë¦¬", "ë‚˜ë°©",
    "ê¸°ë¶„", "ì§‘ì¤‘ë ¥", "ì˜ìš•", "í•œìˆ¨", "ì½§ë¬¼", "ëˆˆêº¼í’€", "ë°°ê³ í””", "ê·€ì°®ìŒ", "í˜„íƒ€", "ì‚ì§"
  ];

  const verbs = [
    "ì‚ì¡Œë‹¤", "ì›ƒì—ˆë‹¤", "ë„ë§ê°”ë‹¤", "ì ë“¤ì—ˆë‹¤", "í‡´ê·¼í–ˆë‹¤", "ì¶œê·¼í–ˆë‹¤", "ê±°ì ˆí–ˆë‹¤", "ë¬´ì‹œí–ˆë‹¤",
    "ë°°ì‹ í–ˆë‹¤", "í¬ê¸°í–ˆë‹¤", "ì«“ì•„ëƒˆë‹¤", "ê¸°ë‹¤ë ¸ë‹¤", "í˜„íƒ€ê°€ ì™”ë‹¤", "ë¨¼ì € ê°”ë‹¤", "í˜¼ì ë†€ì•˜ë‹¤",
    "ê°‘ìê¸° ì§„ì§€í•´ì¡Œë‹¤", "ì“¸ë°ì—†ì´ ì—´ì‹¬ì´ì—ˆë‹¤", "ëŒ€ì¶©í–ˆë‹¤", "ì•„ë¬´ê²ƒë„ ì•ˆ í–ˆë‹¤", "ê·¸ëƒ¥ ìˆì—ˆë‹¤"
  ];

  const endings = [
    "ì´ìœ ëŠ” ì—†ë‹¤.", "ê·¸ëƒ¥ ê·¸ë ‡ë‹¤.", "ì•„ì‰½ê²Œë„.", "ë‹¤í–‰íˆë„.", "ì•„ë§ˆë„.", "ì ˆëŒ€.", "ì§„ì§œë¡œ.", "ë†ë‹´ì´ë‹¤.",
    "ì´ê±´ ìš´ì„¸ê°€ ì•„ë‹ˆë‹¤.", "ì´ ë¬¸ì¥ì€ ì±…ì„ì§€ì§€ ì•ŠëŠ”ë‹¤.", "ì˜¤ëŠ˜ë§Œ ê·¸ë ‡ë‹¤.", "ë‚´ì¼ë„ ê·¸ëŸ´ ìˆ˜ ìˆë‹¤."
  ];

  const patterns = [
    (rng)=>`ì˜¤ëŠ˜ì€ ${josa(rng, pick(rng,nouns),"ì´","ê°€")} ${pick(rng,verbs)}. ${pick(rng,endings)}`,
    (rng)=>`${josa(rng, pick(rng,nouns),"ì€","ëŠ”")} ${pick(rng,verbs)}. ë„ˆëŠ” ëª¨ë¥¸ë‹¤.`,
    (rng)=>`ë„ˆëŠ” ì‚¬ì‹¤ ${pick(rng,nouns)}ë‘ ë‹®ì•˜ë‹¤. ${pick(rng,endings)}`,
    (rng)=>`ì§€ê¸ˆ ${pick(rng,nouns)} ìƒê°ì´ ë‚œë‹¤. ${pick(rng,endings)}`,
    (rng)=>`ë„¤ ${pick(rng,nouns)}(ì€/ëŠ”) ì˜¤ëŠ˜ ì»¨ë””ì…˜ì´ ë³„ë¡œë‹¤. ${pick(rng,endings)}`,
    (rng)=>`ë°©ê¸ˆ ${pick(rng,nouns)}(ì´/ê°€) ë„ˆë¥¼ í‰ê°€í–ˆë‹¤. ê²°ê³¼ëŠ” ë¹„ê³µê°œë‹¤.`,
    (rng)=>`ì˜¤ëŠ˜ì˜ ë¯¸ì…˜: ${pick(rng,["ì•„ë¬´ ìƒê° ì•ˆ í•˜ê¸°","ê´œíˆ ì›ƒì§€ ì•Šê¸°","ë¬¼ ë§ˆì‹œê¸°","ì–‘ë§ ì°¾ê¸°","ë¦¬ëª¨ì»¨ ì°¾ê¸°","í•œìˆ¨ ì‰¬ì§€ ì•Šê¸°","ëŒ€ì¶© ì‚´ê¸°"])}. ${pick(rng,endings)}`,
    (rng)=>`ì§€ê¸ˆ ì´ ë¬¸ì¥ì„ ëê¹Œì§€ ì½ìœ¼ë©´ ${pick(rng,["ì•„ë¬´ ì¼ë„ ì—†ë‹¤","ê·¸ëƒ¥ ëì´ë‹¤","ì¡°ê¸ˆ ë” ì–´ì´ì—†ë‹¤","í˜„íƒ€ê°€ ì˜¨ë‹¤"])}.`,
    (rng)=>`${pick(rng,["ê²½ê³ ","ê³µì§€","ì†ë³´","ê¸´ê¸‰"])}: ${pick(rng,nouns)}(ì´/ê°€) ${pick(rng,verbs)}.`,
    (rng)=>`ë„ˆëŠ” ë°©ê¸ˆ ${pick(rng,["ëˆˆì„ ê¹œë¹¡ì˜€ë‹¤","ìì„¸ë¥¼ ë°”ê¿¨ë‹¤","í•œìˆ¨ ì‰¬ì—ˆë‹¤","ìƒê°ì„ ë©ˆì·„ë‹¤","ì‹œê°„ì„ ë‚­ë¹„í–ˆë‹¤"])}. ì¶•í•˜í•œë‹¤.`
  ];

  // 500ê°œ ë  ë•Œê¹Œì§€ ìƒì„± (ì¤‘ë³µ ìµœì†Œí™”)
  const seen = new Set(pool);
  let attempt = 0;

  while(pool.length < 500 && attempt < 50000){
    attempt++;
    const rng = mulberry32(hashStr("pool-"+attempt));
    const make = pick(rng, patterns);
    let s = make(rng);

    // (ê°€ë²¼ìš´ ì •ë¦¬) ê´„í˜¸ í‘œê¸° ì›ƒê¹€ ìœ ì§€, ë„ˆë¬´ ê¸¸ë©´ ì»·
    s = s.replace(/\s+/g," ").trim();
    if(s.length > 60) s = s.slice(0, 58) + "â€¦";

    if(!seen.has(s)){
      seen.add(s);
      pool.push(s);
    }
  }

  // í˜¹ì‹œ ëª¨ìë¼ë©´ ë§ˆì§€ë§‰ì— ë°˜ë³µ í—ˆìš©(ê±°ì˜ ì•ˆ ê·¸ëŸ¼)
  while(pool.length < 500){
    pool.push("ì˜¤ëŠ˜ì€ ê·¸ëƒ¥ ì˜¤ëŠ˜ì´ë‹¤. ì§„ì§œë¡œ.");
  }

  return pool;
}

const POOL = buildPool500();
$("poolInfo").textContent = `ë¬¸ì¥ í’€: ${POOL.length}ê°œ`;

/* =========================
   3) ìƒíƒœ ì €ì¥ (ì˜¤ëŠ˜/íˆìŠ¤í† ë¦¬/ì¦ê²¨ì°¾ê¸°)
   ========================= */
const LS_TODAY = "one_line_today_v1";   // { key, text, idx, ts }
const LS_HIST  = "one_line_hist_v1";    // [{key, text, mode, ts}]
const LS_SAVED = "one_line_saved_v1";   // [{text, ts}]

function loadJSON(key, fallback){
  try{
    const raw = localStorage.getItem(key);
    if(!raw) return fallback;
    return JSON.parse(raw);
  }catch(e){ return fallback; }
}
function saveJSON(key, val){
  localStorage.setItem(key, JSON.stringify(val));
}

function addHistory(entry){
  const hist = loadJSON(LS_HIST, []);
  hist.unshift(entry);
  saveJSON(LS_HIST, hist.slice(0,20));
  renderHistory();
}

function renderSaved(){
  const saved = loadJSON(LS_SAVED, []);
  const el = $("savedList");
  if(!saved.length){
    el.innerHTML = `<div style="color:var(--muted);font-size:12px;">ì•„ì§ ì €ì¥í•œ ê²Œ ì—†ë‹¤. (â­ ëˆŒëŸ¬ë´ë¼ì‰)</div>`;
    return;
  }
  el.innerHTML = saved.map((x,i)=>`
    <div class="item">
      <div style="min-width:0;">
        <div class="t">${escapeHtml(x.text)}</div>
        <div class="s">${new Date(x.ts).toLocaleString()}</div>
      </div>
      <div class="mini">
        <button onclick="copyText(${i}, 'saved')">ë³µì‚¬</button>
        <button onclick="removeSaved(${i})">ì‚­ì œ</button>
      </div>
    </div>
  `).join("");
}

function renderHistory(){
  const hist = loadJSON(LS_HIST, []);
  const el = $("historyList");
  if(!hist.length){
    el.innerHTML = `<div style="color:var(--muted);font-size:12px;">íˆìŠ¤í† ë¦¬ ì—†ìŒ. (ëœë¤ ë½‘ê¸° ã„±ã„±)</div>`;
    return;
  }
  el.innerHTML = hist.map((x,i)=>`
    <div class="item">
      <div style="min-width:0;">
        <div class="t">${escapeHtml(x.text)}</div>
        <div class="s">${x.mode} Â· ${x.key} Â· ${new Date(x.ts).toLocaleTimeString()}</div>
      </div>
      <div class="mini">
        <button onclick="copyText(${i}, 'hist')">ë³µì‚¬</button>
      </div>
    </div>
  `).join("");
}

function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, m => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  }[m]));
}

/* =========================
   4) í¬ì¸ˆ ë½‘ê¸° ë¡œì§
   ========================= */
function showFortune(text, mode, idx){
  $("fortuneText").textContent = text;
  $("labelMode").textContent = mode;
  $("metaLeft").textContent = `ë¬¸ì¥ë²ˆí˜¸: #${idx+1}`;
  $("metaRight").textContent = `í’€: ${POOL.length}ê°œ`;
}

function pickToday(){
  const key = todayKey();
  $("todayKey").textContent = `ì˜¤ëŠ˜ í‚¤: ${key}`;

  const stored = loadJSON(LS_TODAY, null);
  if(stored && stored.key === key && stored.text){
    showFortune(stored.text, "âœ… ì˜¤ëŠ˜ì˜ ê°œì†Œë¦¬(ê³ ì •)", stored.idx ?? 0);
    return stored;
  }

  // ì˜¤ëŠ˜ seedë¡œ ê³ ì • ì„ íƒ
  const rng = mulberry32(hashStr("today-"+key));
  const idx = Math.floor(rng() * POOL.length);
  const text = POOL[idx];

  const obj = { key, text, idx, ts: Date.now() };
  saveJSON(LS_TODAY, obj);

  showFortune(text, "âœ… ì˜¤ëŠ˜ì˜ ê°œì†Œë¦¬(ê³ ì •)", idx);
  addHistory({ key, text, mode:"ì˜¤ëŠ˜", ts: Date.now() });

  return obj;
}

function pickRandom(){
  const rng = mulberry32((Math.random()*1e9)>>>0);
  const idx = Math.floor(rng() * POOL.length);
  const text = POOL[idx];

  showFortune(text, "ğŸ² ëœë¤(ê·¸ëƒ¥ ë½‘ê¸°)", idx);
  addHistory({ key: todayKey(), text, mode:"ëœë¤", ts: Date.now() });
}

function resetToday(){
  localStorage.removeItem(LS_TODAY);
  toast("ì˜¤ëŠ˜ ê³ ì • ì´ˆê¸°í™”ë¨");
  $("labelMode").textContent = "ì•„ì§ ì•ˆ ì—´ì—ˆìŒ";
  $("fortuneText").textContent = "ë²„íŠ¼ ëˆŒëŸ¬ë¼ì‰.";
  $("metaLeft").textContent = "â€”";
  $("metaRight").textContent = "â€”";
}

/* =========================
   5) ë²„íŠ¼ ë™ì‘
   ========================= */
function saveCurrent(){
  const text = $("fortuneText").textContent.trim();
  if(!text || text === "ë²„íŠ¼ ëˆŒëŸ¬ë¼ì‰."){
    toast("ì €ì¥í•  ê²Œ ì—†ë‹¤ì‰");
    return;
  }
  const saved = loadJSON(LS_SAVED, []);
  if(saved.some(x=>x.text === text)){
    toast("ì´ë¯¸ ì €ì¥ë¼ìˆë‹¤ì‰");
    return;
  }
  saved.unshift({ text, ts: Date.now() });
  saveJSON(LS_SAVED, saved);
  renderSaved();
  toast("â­ ì €ì¥ë¨");
}

async function copyCurrent(){
  const text = $("fortuneText").textContent.trim();
  if(!text || text === "ë²„íŠ¼ ëˆŒëŸ¬ë¼ì‰."){ toast("ë³µì‚¬í•  ê²Œ ì—†ë‹¤ì‰"); return; }
  try{
    await navigator.clipboard.writeText(text);
    toast("ë³µì‚¬ë¨");
  }catch(e){
    // fallback
    const ta = document.createElement("textarea");
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand("copy");
    ta.remove();
    toast("ë³µì‚¬ë¨");
  }
}

window.removeSaved = function(i){
  const saved = loadJSON(LS_SAVED, []);
  saved.splice(i,1);
  saveJSON(LS_SAVED, saved);
  renderSaved();
  toast("ì‚­ì œë¨");
}

window.copyText = async function(i, from){
  const arr = from === "saved" ? loadJSON(LS_SAVED, []) : loadJSON(LS_HIST, []);
  const text = arr[i]?.text;
  if(!text) return;
  try{
    await navigator.clipboard.writeText(text);
    toast("ë³µì‚¬ë¨");
  }catch(e){
    toast("ë³µì‚¬ ì‹¤íŒ¨(ê¶Œí•œ)");
  }
}

/* =========================
   6) ì´ˆê¸° ë Œë”
   ========================= */
$("todayKey").textContent = `ì˜¤ëŠ˜ í‚¤: ${todayKey()}`;
renderSaved();
renderHistory();

// ë²„íŠ¼ ì—°ê²°
$("btnOpen").addEventListener("click", ()=>{ pickToday(); });
$("btnRandom").addEventListener("click", ()=>{ pickRandom(); });
$("btnReset").addEventListener("click", ()=>{ resetToday(); });
$("btnSave").addEventListener("click", ()=>{ saveCurrent(); });
$("btnCopy").addEventListener("click", ()=>{ copyCurrent(); });

// í˜ì´ì§€ ë“¤ì–´ì˜¤ë©´: ì´ë¯¸ ì˜¤ëŠ˜ ì—´ì—ˆìœ¼ë©´ ë³´ì—¬ì£¼ê¸°
(function boot(){
  const key = todayKey();
  const stored = loadJSON(LS_TODAY, null);
  if(stored && stored.key === key && stored.text){
    showFortune(stored.text, "âœ… ì˜¤ëŠ˜ì˜ ê°œì†Œë¦¬(ê³ ì •)", stored.idx ?? 0);
  }else{
    // ì•ˆë‚´ í…ìŠ¤íŠ¸ ìœ ì§€
  }
})();
</script>
</body>
</html>
