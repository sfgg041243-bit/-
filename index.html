<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ğŸ¥  í¬ì¶˜ì¿ í‚¤</title>
  <style>
    :root{
      --bg0:#060912;
      --bg1:#0A1022;
      --text:#ECF2FF;
      --muted:rgba(236,242,255,.65);
      --line:rgba(255,255,255,.12);
      --shadow: 0 24px 80px rgba(0,0,0,.55);
      --r:34px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, Noto Sans KR, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font);
      background:
        radial-gradient(900px 520px at 18% 0%, rgba(125,211,252,.14), transparent 62%),
        radial-gradient(900px 520px at 82% 0%, rgba(167,243,208,.10), transparent 62%),
        radial-gradient(900px 620px at 50% 120%, rgba(251,113,133,.08), transparent 62%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      color:var(--text);
      display:grid;
      place-items:center;
      padding:18px;
    }

    .stage{display:grid;place-items:center;gap:12px;user-select:none;-webkit-tap-highlight-color:transparent}
    .cookieBtn{
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      border-radius:var(--r);
      box-shadow:var(--shadow);
      padding:22px 24px;
      cursor:pointer;
      transition:.16s transform,.16s background,.16s border-color;
      width:min(320px, 84vw);
      height:260px;
      display:grid;
      place-items:center;
      position:relative;
      overflow:hidden;
    }
    .cookieBtn:hover{background:rgba(255,255,255,.07);border-color:rgba(255,255,255,.16)}
    .cookieBtn:active{transform:scale(.985)}

    .cookieWrap{position:relative;width:180px;height:180px;display:grid;place-items:center}
    .half{
      position:absolute;
      font-size:150px;
      line-height:1;
      filter: drop-shadow(0 16px 34px rgba(0,0,0,.35));
      will-change: transform, opacity;
    }
    .left{clip-path: inset(0 50% 0 0);transform: translateX(0) rotate(0deg)}
    .right{clip-path: inset(0 0 0 50%);transform: translateX(0) rotate(0deg)}
    .crack{
      position:absolute;
      width:4px;height:160px;
      background:linear-gradient(180deg, rgba(255,255,255,0), rgba(255,255,255,.55), rgba(255,255,255,0));
      opacity:0;border-radius:10px;transform: rotate(6deg);
    }

    @keyframes shake {
      0%{transform:translateX(0) rotate(0deg)}
      20%{transform:translateX(-6px) rotate(-3deg)}
      40%{transform:translateX(6px) rotate(3deg)}
      60%{transform:translateX(-4px) rotate(-2deg)}
      80%{transform:translateX(4px) rotate(2deg)}
      100%{transform:translateX(0) rotate(0deg)}
    }
    @keyframes crackIn {
      0%{opacity:0; transform:scaleY(.2) rotate(6deg)}
      100%{opacity:1; transform:scaleY(1) rotate(6deg)}
    }
    @keyframes splitLeft {
      0%{transform:translateX(0) rotate(0deg); opacity:1}
      100%{transform:translateX(-42px) rotate(-14deg); opacity:.98}
    }
    @keyframes splitRight {
      0%{transform:translateX(0) rotate(0deg); opacity:1}
      100%{transform:translateX(42px) rotate(14deg); opacity:.98}
    }

    .isCracking .cookieWrap{ animation: shake .22s ease-in-out; }
    .isCracking .crack{ animation: crackIn .18s ease-out forwards; }
    .isCracking .left{ animation: splitLeft .22s ease-out forwards; }
    .isCracking .right{ animation: splitRight .22s ease-out forwards; }

    .hint{font-size:12px;color:var(--muted);text-align:center}

    .overlay{
      position:fixed; inset:0;
      display:none;
      place-items:center;
      padding:18px;
      background:rgba(0,0,0,.62);
      backdrop-filter: blur(10px);
      z-index:50;
    }
    .sheet{
      width:min(980px, 100%);
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.55);
      border-radius:38px;
      box-shadow: 0 26px 90px rgba(0,0,0,.65);
      padding:34px 26px;
      position:relative;
      overflow:hidden;
    }
    .sheet:before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(900px 420px at 18% 0%, rgba(125,211,252,.18), transparent 60%),
        radial-gradient(900px 420px at 85% 10%, rgba(167,243,208,.12), transparent 60%);
      opacity:.55;
      pointer-events:none;
    }
    .fortune{
      position:relative;
      margin:0;
      font-weight:900;
      letter-spacing:-.7px;
      text-align:center;
      font-size:clamp(28px, 5vw, 58px);
      line-height:1.15;
      white-space:pre-line;
      word-break:keep-all;
    }
  </style>
</head>

<body>
  <div class="stage">
    <div class="cookieBtn" id="cookieBtn" aria-label="í¬ì¶˜ì¿ í‚¤ ì—´ê¸°">
      <div class="cookieWrap" aria-hidden="true">
        <div class="crack"></div>
        <div class="half left">ğŸ¥ </div>
        <div class="half right">ğŸ¥ </div>
      </div>
    </div>
    <div class="hint">ì¿ í‚¤ ëˆŒëŸ¬ë¼ì‰.</div>
  </div>

  <div class="overlay" id="overlay" role="dialog" aria-modal="true">
    <div class="sheet">
      <p class="fortune" id="fortuneText">â€”</p>
    </div>
  </div>

  <!-- âš ï¸ scriptëŠ” ë°˜ë“œì‹œ body ë§¨ ì•„ë˜ì— ìˆì–´ì•¼ í´ë¦­ì´ ë¨¹ëŠ”ë‹¤ -->
  <script>
    const $ = (id)=>document.getElementById(id);

    /* =========================
       1) ë¬¸ì¥(ìƒ˜í”Œ + íŒ¨ë”©ìœ¼ë¡œ 365 ì±„ì›€)
       - ë„ˆëŠ” ì—¬ê¸° 365ê°œë¥¼ â€œìˆ˜ë™â€ìœ¼ë¡œ ì­‰ ë„£ìœ¼ë©´ ë¨
       ========================= */
    const FORTUNES_365 = [
      "ì˜¤ëŠ˜ì€ ì–‘ë§ì´ ë„ˆë¥¼ ì‹«ì–´í•œë‹¤.",
      "ë°©ê¸ˆ ê·¸ ìƒê°â€¦ í•˜ì§€ ë§ˆë¼ì‰.",
      "ê³ ì–‘ì´ëŠ” ì•Œê³  ìˆë‹¤.\nê·¼ë° ë§ ì•ˆ í•œë‹¤.",
      "ê°‘ìê¸° ì˜¤ì´ ìƒê°ë‚œë‹¤.\nì™œì¸ì§„ ëª°ë¼.",
      "ë„¤ê°€ ê¹œë¹¡í•œ ê±° ìˆì§€.\nê·¸ê±° ë§ë‹¤.",
      "ìˆŸê°€ë½ì´ í¬í¬ë¥¼ ë¬´ì‹œí–ˆë‹¤.\nì–´ì©Œê² ë…¸.",
      "ì—˜ë¦¬ë² ì´í„°ê°€ ì˜¤ëŠ˜ ë„ˆ í…ŒìŠ¤íŠ¸í•œë‹¤.",
      "ì§€ê¸ˆ ì›ƒìœ¼ë©´ ì§„ ê±°ë‹¤.",
      "ê´œíˆ ì§„ì§€í•´ì§€ì§€ ë§ˆë¼.\në…¸ì¼ ëœë‹¤.",
      "ë°”ë‚˜ë‚˜ëŠ” ë°”ë‚˜ë‚˜ë‹µê²Œ ì‚°ë‹¤.\në„ˆë„ ê·¸ë˜ë¼.",
      "ì˜¤ëŠ˜ ë¬¼ì´ ë§›ì—†ë‹¤.\në„¤ íƒ“ ë§ë‹¤.",
      "ë„ˆ ë¹„ë‘˜ê¸° ë‹®ì•˜ë‹¤ëŠ” ë§\në“¤ì–´ë´¤ëƒ.",
      "ì˜¤ëŠ˜ì˜ ìš´ì„¸: ê·¸ëƒ¥ ê·¸ëŸ¼.",
      "ì™€ì´íŒŒì´ê°€ ì‚ì¡Œë‹¤.\n(ì‚ì§=ê¸°ë¶„ ìƒí•¨)",
      "ë°°í„°ë¦¬ê°€ ë¶ˆì•ˆí•˜ë‹¤.\n(unstable=ë¶ˆì•ˆì •)",
      "ì´ì–´í° í•œìª½ë§Œ ì‚¶ì˜ ì˜ì§€ ìˆìŒ.",
      "ê´œíˆ â€˜ã…‹ã…‹â€™ ë‚¨ë°œí•˜ì§€ ë§ˆë¼.\ní‹° ë‚œë‹¤.",
      "ì˜¤ëŠ˜ì€ chill.\n(ëŠê¸‹í•˜ê²Œ í•˜ì)",
      "ì¿ í‚¤ ëˆŒë €ìœ¼ë©´ ëë‹¤.\në.",
    ];

    (function padTo365(){
      const extras = [
        "ì˜¤ëŠ˜ì€ ì˜ìê°€ ë§ì„ ì•ˆ ë“£ëŠ”ë‹¤.",
        "ì§€ê¸ˆ ì´ê±° ì½ì„ íƒ€ì´ë° ì•„ë‹Œë°?",
        "ê´œíˆ ê°ì„± íƒ€ì§€ ë§ˆë¼.\nì¶¥ë‹¤.",
        "í° ë‚´ë ¤ë†“ì„ ìƒê° 0%ì§€?",
        "ë¬¼ ë§ˆì…”ë¼ì‰.\n(ì§„ì‹¬)",
        "í˜„íƒ€ëŠ” ì„ ì°©ìˆœì´ë‹¤.\në„ˆ ë¨¼ì €.",
        "ì˜¤ëŠ˜ì€ ê·¸ëƒ¥ ëŒ€ì¶©ì´ ì´ê¸´ë‹¤.",
        "ê²°ë¡  ì—†ìŒ.\n(ì›ë˜ ì—†ìŒ)",
        "ê°‘ìê¸° ì¹˜í‚¨ ìƒê°ë‚˜ë©´ ì´ë¯¸ ë.",
        "ì˜¤ëŠ˜ì€ â€˜ì•„â€™ ì†Œë¦¬ ë‚´ë©´ íŒ¨ë°°ë‹¤."
      ];
      let i = 0;
      while (FORTUNES_365.length < 365) {
        FORTUNES_365.push(extras[i % extras.length]);
        i++;
      }
      if (FORTUNES_365.length > 365) FORTUNES_365.length = 365;
    })();

    /* =========================
       2) ì¤„ë°”ê¿ˆ ì˜ˆì˜ê²Œ (ìë™ ë¶„í• )
       ========================= */
    function splitNice(text){
      let t = String(text || "").trim();
      if (!t) return "â€”";
      if (t.includes("\n")) return t;

      const cuts = ["â€¦", ".", "?", "!", ",", "ã…‹ã…‹ã…‹", "ã…‹ã…‹", "ã…‹"];
      for (const c of cuts) {
        const p = t.indexOf(c);
        if (p > 7 && p < t.length - 7) {
          if (c.startsWith("ã…‹")) {
            const m = t.match(/ã…‹+/);
            if (m && m.index > 7 && m.index < t.length - 7) {
              const kpos = m.index + m[0].length;
              return t.slice(0, kpos).trim() + "\n" + t.slice(kpos).trim();
            }
          }
          return t.slice(0, p + 1).trim() + "\n" + t.slice(p + 1).trim();
        }
      }

      const words = t.split(/\s+/);
      if (words.length >= 6) {
        const mid = Math.floor(words.length / 2);
        return words.slice(0, mid).join(" ") + "\n" + words.slice(mid).join(" ");
      }

      const midChar = Math.floor(t.length / 2);
      return t.slice(0, midChar).trim() + "\n" + t.slice(midChar).trim();
    }

    /* =========================
       3) ì‚¬ëŒë§ˆë‹¤ ëœë¤ + 6ì‹œê°„ë§ˆë‹¤ ë³€ê²½
       ========================= */
    const LS_USER_SEED = "fortune_user_seed_v2";
    const LS_SLOT_CACHE = "fortune_slot_cache_v2";

    function loadJSON(key){
      try{ return JSON.parse(localStorage.getItem(key) || "null"); }catch(e){ return null; }
    }
    function saveJSON(key,val){ localStorage.setItem(key, JSON.stringify(val)); }

    function randomInt(){
      if (window.crypto && crypto.getRandomValues) {
        const a = new Uint32Array(1);
        crypto.getRandomValues(a);
        return a[0] >>> 0;
      }
      return (Math.random() * 0xFFFFFFFF) >>> 0;
    }
    function getUserSeed(){
      const raw = localStorage.getItem(LS_USER_SEED);
      if (raw && !Number.isNaN(Number(raw))) return (Number(raw) >>> 0);
      const seed = randomInt();
      localStorage.setItem(LS_USER_SEED, String(seed));
      return seed >>> 0;
    }
    function hashStr(s){
      let h = 2166136261;
      for (let i=0;i<s.length;i++){
        h ^= s.charCodeAt(i);
        h = Math.imul(h, 16777619);
      }
      return h >>> 0;
    }
    function pad2(n){ return String(n).padStart(2,"0"); }

    function slotKey6h(){
      const d = new Date();
      const slot = Math.floor(d.getHours() / 6); // 0,1,2,3
      return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}-S${slot}`;
    }

    function getFortuneForCurrentSlot(){
      const key = slotKey6h();
      const cached = loadJSON(LS_SLOT_CACHE);
      if (cached && cached.key === key && typeof cached.idx === "number") return cached;

      const userSeed = getUserSeed();
      const h = hashStr(String(userSeed) + "::" + key);
      const idx = h % 365;

      const obj = { key, idx, ts: Date.now() };
      saveJSON(LS_SLOT_CACHE, obj);
      return obj;
    }

    /* =========================
       4) í´ë¦­ ë™ì‘
       ========================= */
    const btn = $("cookieBtn");
    const overlay = $("overlay");
    const fortuneEl = $("fortuneText");

    if (!btn || !overlay || !fortuneEl) {
      console.error("í•„ìˆ˜ ìš”ì†Œ idê°€ ì—†ê±°ë‚˜ ê¹¨ì§:", { btn, overlay, fortuneEl });
    }

    let cracking = false;

    function showFortune(){
      const { idx } = getFortuneForCurrentSlot();
      fortuneEl.textContent = splitNice(FORTUNES_365[idx]);
      overlay.style.display = "grid";
    }

    function resetAnim(){
      btn.classList.remove("isCracking");
      void btn.offsetWidth; // reflow for restart animation
    }

    btn.addEventListener("click", ()=>{
      if (cracking) return;
      cracking = true;

      resetAnim();
      btn.classList.add("isCracking");

      setTimeout(showFortune, 220);
      setTimeout(()=>{ cracking = false; }, 380);
    });

    overlay.addEventListener("click", ()=>{ overlay.style.display = "none"; });
    window.addEventListener("keydown", (e)=>{ if (e.key === "Escape") overlay.style.display = "none"; });

    // 6ì‹œê°„ ìŠ¬ë¡¯ ë°”ë€Œë©´ ìºì‹œ ë¦¬ì…‹ + ì—´ë ¤ ìˆìœ¼ë©´ ë¬¸ì¥ ê°±ì‹ 
    let lastSlot = slotKey6h();
    setInterval(()=>{
      const nowSlot = slotKey6h();
      if (nowSlot !== lastSlot){
        lastSlot = nowSlot;
        localStorage.removeItem(LS_SLOT_CACHE);
        if (overlay.style.display === "grid") showFortune();
      }
    }, 15000);
  </script>
</body>
</html>
